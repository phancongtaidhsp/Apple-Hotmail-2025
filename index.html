<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Apple - Hotmail (2025. v1)</title>
  <!-- https://electronjs.org/docs/tutorial/security#csp-meta-tag -->
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="./css/bootstrap.css">
</head>

<body>
  <h1 class="title-app">Apple - Hotmail (2025. v1)</h1>
  <div id="thongbao" class="alert alert-success hidden" role="alert">
    Đã chạy xong file data
  </div>
  <div class="wr">
    <button id="start" type="button" class="button btn btn-primary">Start</button>
    <button id="pause" type="button" class="button btn btn-danger">Pause</button>
    <button id="result" class="button btn btn-info">Xuất kết quả</button>
    <div class="value">
      <input type="text" id="filepathmail" placeholder="Đường dẫn file mail" value="E:\data\output\success.txt">
      <input type="text" id="keynopecha" placeholder="Key nopecaptcha" value="okabyf0t8m_BLVGCZCW">
      <input type="text" id="keyproxy" placeholder="Key tm proxy (cách nhau bằng dấu |)" value="a2b07f90caf4019ddedf4c3991a7065d">
    </div>
    <div class="value">
      <input class="numberinput" type="number" id="soluong" placeholder="Số luồng (nhỏ hơn 10)">
    </div>
    <div class="value">
      <div class="total">
        <span>Time: </span>
        <span id="time">0s</span>
      </div>
    </div>
    <div class="value">
      <div class="success">
        <span>Success: </span>
        <span id="success">0</span>
      </div>
      <div class="fail">
        <span>Fail: </span>
        <span id="fail">0</span>
      </div>
      <div class="total">
        <span>Total: </span>
        <span id="total">0</span>
      </div>
    </div>
  </div>
  <script>
    require('./app.js');
    const electron = require('electron');
    const { ipcRenderer } = electron;
    function showThongBao(type, message, isTimeout) {
      document.getElementById('thongbao').innerText = message;
      document.getElementById('thongbao').className = `alert ${type}`;
      document.getElementById('thongbao').classList.remove('hidden')
      if (!isTimeout) {
        setTimeout(() => document.getElementById('thongbao').classList.add('hidden'), 3000);
      }
    }
    ipcRenderer.on('total', function (e, total) {
      document.getElementById(`total`).innerText = total;
    })
    ipcRenderer.on('fail', function (e, step, pause) {
      let failStep = parseInt(document.getElementById(`fail`).innerText) + step;
      let successStep = parseInt(document.getElementById(`success`).innerText);
      let totalStep = parseInt(document.getElementById(`total`).innerText);
      document.getElementById(`fail`).innerText = failStep;
      if (pause && failStep + successStep === totalStep) {
        document.getElementById('thongbao').classList.add('hidden')
        document.getElementById('start').disabled = false;
      } else if (!pause && failStep + successStep === totalStep) {
        showThongBao('alert-success', 'Đã chạy hết file data')
      }
    })
    ipcRenderer.on('success', function (e, step, pause) {
      let failStep = parseInt(document.getElementById(`fail`).innerText);
      let successStep = parseInt(document.getElementById(`success`).innerText) + step;
      let totalStep = parseInt(document.getElementById(`total`).innerText);
      document.getElementById(`success`).innerText = successStep;
      if (pause && failStep + successStep === totalStep) {
        document.getElementById('thongbao').classList.add('hidden')
        document.getElementById('start').disabled = false;
      } else if (!pause && failStep + successStep === totalStep) {
        showThongBao('alert-success', 'Đã chạy hết file data')
      }
    })
    ipcRenderer.on('disable', function (e, isDisable) {
      document.getElementById('start').disabled = isDisable;
      document.getElementById('result').disabled = isDisable;
    })
    ipcRenderer.on('time', function (e, time) {
      let h, m, s
      if (time / 3600 >= 1) {
        h = Math.floor(time / 3600);
        s = time % 3600;
        m = 0;
        if (s / 60 >= 1) {
          m = Math.floor(s / 60);
          s = s % 60;
        }
        document.getElementById(`time`).innerText = `${h}h${m}m${s}s`
      } else if (time / 60 >= 1) {
        m = Math.floor(time / 60)
        s = time % 60
        document.getElementById(`time`).innerText = `0h${m}m${s}s`
      } else {
        document.getElementById(`time`).innerText = `0h0m${time}s`
      }
    })
    ipcRenderer.on('done', function (e, isDone) {
      if (isDone) {
        showThongBao('alert-success', 'Đã chạy hết file data')
      }
    })
    ipcRenderer.on('checkfiles', function (e, filename) {
      showThongBao('alert-danger', `Đường dẫn file không hợp lệ: ${filename}`)
    })
    ipcRenderer.on('failProxyKey', function (e, key) {
      showThongBao('alert-danger', `proxy key: ${key} không hợp lệ`)
    })
    ipcRenderer.on('pause', function (e, info, noTimeout) {
      showThongBao('alert-info', info, noTimeout)
      document.getElementById('start').disabled = isDisable;
    })
    ipcRenderer.on('loi', function (e, err, noTimeout) {
      showThongBao('alert-danger', err, noTimeout)
    })
    ipcRenderer.on('result', function (e, isSuccess) {
      if (isSuccess) {
        showThongBao('alert-success', 'Xuất kết quả thành công')
      }
      else {
        showThongBao('alert-danger', 'Xuất kết quả thất bại')
      }
    })
  </script>
</body>

</html>